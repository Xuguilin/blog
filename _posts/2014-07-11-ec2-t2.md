---
layout: post
title: AWS推出全新的T2实例
---

{{ page.title }}
================

<p class="meta">2014/07/11 - 上海 By 徐桂林</p>

AWS最近高调宣布最新的实例类型：T2，其基本性能参数（及与其他相关实例类型对比）如下图：

![T系列实例类型](/images/2014-07-11/instance-types.jpg)

新实例有如下一些特征：

- 价格便宜。该实例类型价格比其他AWS实例类型要便宜不少，其中的t2.micro实例类型按需付费的价格是$0.013/小时，相当于$9.50/月。
- 可以累计“计算积分”（CPU Credit）。简单来说，就是如果你的实例平时非常空闲，其CPU消耗低于上表中Baseline Performance的话，你付费的这些实例时间会被当做“计算积分”存储起来，当有突发流量需要大计算资源时存储的“计算积分”再集中释放出来使用。如此一来，你的单个实例内计算能力就有更好的弹性。当然这个累计的”计算积分“也是有上限的（到上限后”计算积分“就不再向上升），具体细节可以参考上面的AWS博客链接。
- 基于HVM而非PV的虚拟化技术。AWS EC2使用的虚拟化计算包括PV和HVM两种（http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/virtualization_types.html ）。其中，早期的实例类型大部分都是基于PV（因为性能问题），而新实例类型基本都转向HVM（因为HVM自身的特点和其性能的持续改善）。个人觉得这是其能对CPU资源做“计算积分”这样精确控制的关键所在。
- 加入Free Tier套餐。AWS对于新开户的账号有一个免费套餐，以前包括EC2的T1.micro类型实例，现在使用T2.micro代替。这也意味着新用户接触到的EC2的第一个实例类型就非常可能是T2，而且还可以免费使用一个T2.micro实例一年。

AWS T2实例类型发布应该是最近AWS最高调的一次产品发布。除常规的博客等渠道，AWS还做了其他很多渠道的宣传（如给客户单独发一封长邮件介绍T2，其实AWS单独为一个产品发布给客户发邮件并不多见），可见AWS对此实例类型的重视程度。个人觉得其背后可能有如下原因：

- T2实例价格（最低到$9.95/月）给人的第一感觉就是AWS终于做不住，开始推10美元以下的实例类型和竞争对手正面竞争（可能很多人都知道很多其他IaaS打的一张牌就是10美元以下的实例类型）。
- 彻底解决T1.micro实例类型留下的问题，为未来更多精细控制资源的实例类型推出打基础。其实AWS实例类型已经非常丰富（针对多种需求都有自己的实例系列，尤其是还有GPU相关实例），而且其主要客户是企业，对于价格并不是很敏感（至少不会像个人用户那么敏感），所以低价一定不是所有原因（甚至都不是主要原因）。当看到这个类型实例命名为"T2"，我就想起AWS之前提供的T1实例类型（只有t1.micro一种）。如果拿T1和T2做个比较，你就会发现其实T2是对T1实例的一种根本性改进。首先让我们看看T1实例类型的使用场景，根据AWS的文档描述（），它主要适合于CPU使用率如下的特定场景（图片来自AWS文档）：

![CPU-Usage使用率](/images/2014-07-11/cpu-usage.jpg)

在上面这个图上可以看出T1实例CPU使用率的一些特征：

	- Baseline Performance非常低，甚至AWS都没有明确告诉大家其Baseline Performance到底多少，只是保证不会为零。
	- 可以处理非常短的CPU Brust，但是这些Brust来的频率需要比较低（体现在上图中，这些Brust在时间轴上分布比较稀疏）

如果你的应用并不满足上面特征而使用T1实例，那么AWS会主动限制实例使用CPU，从而影响到服务的响应。显然，这种实例对绝大部分商业应用都并不合适（我们曾经想把系统中一个轻调度决算的实例换成T1类型，但最终还是放弃）。个人觉得T1实例从商业的角度上说并不是一个成功的尝试（估计AWS设计它的主要目的也就是为Free Tier用户试用AWS服务，我个人账号就在运行一个T1实例）。

如果对照上面T1实例类型，我们再去看看T2实例类型的设计就很有意思，首先，它引入Baseline Performance的概念，保证你的实例在任何时候都能有一个稳定的CPU资源预期（具体Baseline Performance会因Size不同而有所区别，详细值请见最上面的表格）。另外，为保证你的实例能够较好的处理CPU Brust而又不会对AWS整个服务资源造成太大压力，它引入”计算积分“逻辑，让你在需要较高、较长CPU计算资源的时候有一个积累的CPU资源池来持续使用一段时间。这样，T2实例就具有比较大的灵活性，能适应小型网站和服务的商业需求。而且，这种比T1有明显优势的实例类型价格比T1还便宜非常多（低50%左右）

随着越来越多的第二代实例类型的推出，AWS基本完成所有实例类型的更新换代。尽管AWS明确表示上一代实例类型仍然会运行下去，但仍建议大家尽快使用新一代实例。毕竟新实例类型”价格便宜量又足“。另外，AWS的这个文档（http://aws.amazon.com/ec2/previous-generation/#Upgrade_Paths）已提供比较详细的实例升级指导。

最后，回顾AWS最近推出的SSD-baked EBS和T2实例类型。新EBS利用Token Bucket方式支持更灵活的IOPS需求，而T2则使用”计算积分“方式更好得处理CPU Brust，可以看出AWS在云计算资源的精细控制力度上已经上到一个新的台阶。AWS已经把对资源的弹性需求从原来的Auto-Scaling层面（实例级别的水平扩展）延伸到一个实例内部资源的弹性使用上。这样最大的好处在于更好服务用户的同时大大提升整个基础设施的利用率，从而降低单位服务的成本，产生新的竞争优势。这应该是一个利用技术降低成本，从而建立新竞争优势的典型案例。当然，我们可能还需要观察一段时间，看看T2实例的实际使用情况。如果整体反馈非常正面的话，或许AWS还会推出更多”T系列“的实例类型。
